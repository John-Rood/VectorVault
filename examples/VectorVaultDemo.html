<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vector Vault Demo</title>
    <body>
        <a href="https://billing.vectorvault.io/b/fZebMidA915jdfG8wB" target="_blank" style="font-size: 12px;">Get Vector Vault API Key</a>
        <h1>Vector Vault Demo</h1>
        <style>
            body {
                font-family: Arial, sans-serif;
                background-color: #f4f4f4;
                padding: 20px;
                text-align: center;
            }
    
            h1 {
                color: #333;
            }
    
            #responseContainer {
                min-height: 300px;
                overflow-y: auto;
                border: 1px solid #ccc;
                padding: 10px;
                margin: 20px auto;
                width: 80%;
                background-color: white;
                text-align: left;
            }
    
            .container {
                width: 90%;
                margin: auto;
                text-align: left;
            }

            table {
                width: 100%;
                border-collapse: collapse;
                margin-top: 20px;
            }

            table, th, td {
                border: 1px solid #ddd;
            }

            th, td {
                padding: 8px;
                text-align: left;
            }

            th {
                background-color: #f4f4f4;
            }

            tr:nth-child(even) {
                background-color: #f9f9f9;
            }

            #pagination {
                margin-top: 20px;
                text-align: center;
            }

            #pagination button {
                padding: 5px 10px;
                margin: 0 5px;
                background-color: rgb(69, 103, 226);
                color: white;
                border: none;
                border-radius: 4px;
                cursor: pointer;
            }

            #pagination button:hover {
                background-color: rgb(52, 78, 172);
            }

            #pagination button:disabled {
                background-color: #ccc;
                cursor: not-allowed;
            }

            .add-group {
                margin-top: 10px;
                display: flex;
                align-items: center;
                justify-content: center; /* Center items horizontally */
                gap: 10px;
                flex-wrap: wrap; /* Wrap items to the next line if space is not sufficient */
            }

            .input-group {
                margin-top: 10px;
                text-align: center;
            }

            .input-field, .input-textarea, .action-button {
                padding: 10px;
                margin-right: 5px; /* Adjust spacing between elements */
                border: 1px solid #ddd;
                border-radius: 4px;
                box-sizing: border-box;
            }

            .input-field {
                width: calc(20% - 12px); /* Adjust width as necessary, subtracting padding and margin */
                display: inline-block;
            }

            .input-textarea {
                width: calc(60% - 12px); /* Adjust width as necessary, subtracting padding and margin */
                display: inline-block;
                vertical-align: top;
            }

            .personality-textarea {
                width: calc(50% - 12px); /* Adjust width as necessary, subtracting padding and margin */
                display: inline-block;
                vertical-align: top;
            }

            .action-button {
                width: calc(20% - 12px); /* Adjust width as necessary, subtracting padding and margin */
                display: inline-block;
                background-color: rgb(69, 103, 226);
                color: white;
                border: none;
                cursor: pointer;
            }

            .action-button:hover {
                background-color: rgb(52, 78, 172);
            }

            .container-header {
                display: flex;
                justify-content: flex-end;
                align-items: right;
                padding: 0 10px;
            }

            .container-header h3 {
                margin: 0;
            }

            .container-header a {
                color: #007bff;
                text-decoration: none;
            }

            .container-header a:hover {
                text-decoration: underline;
            }

            .spinner {
                border: 4px solid rgba(0, 0, 0, 0.1);
                width: 36px;
                height: 36px;
                border-radius: 50%;
                border-left-color: #09f;

                animation: spin 1s ease infinite;
            }

            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }

        </style>
        <div>
            <input type="text" id="user" placeholder="User Email">
            <input type="text" id="vault" placeholder="Vault Name">
            <input type="text" id="api" placeholder="API Key">
            <input type="text" id="openai_key" placeholder="OpenAI Key">
            <button onclick="connectToVault()">Connect</button>
        </div>
        <div class="add-group" style="display: flex; align-items: center; gap: 10px;">
            <label for="addToVaultSelector">Add to Vault:</label>
            <select id="addToVaultSelector" onchange="toggleInputFields()">
                <option value="url">Add URL</option>
                <option value="text">Add Plain Text</option>
            </select>
            <div id="urlInput">
                <input type="text" id="site" placeholder="Enter site URL">
                <button onclick="addSiteToVault()">Add Site</button>
            </div>
            <div id="textInput">
                <textarea id="data" class="input-textarea" placeholder="Enter data to save in vault"></textarea>
                <button onclick="saveDataToVault()">Save Data</button>
            </div>
        </div>

        <div class="input-group">
            <textarea id="personalityMessage" class="personality-textarea" placeholder="Enter personality message" rows="1"></textarea>
            <button onclick="savePersonalityMessageToVault()">Save Personality Message</button>
        </div>
        <div id="responseContainer" style="min-height: 400px; overflow-y: auto; border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; box-sizing: border-box;">
            <div class="container-header">
                <a href="#" onclick="clearChat(); return false;" title="Clear Chat">Clear</a>
            </div>
        </div>
        <div class="input-group">
            <label for="modelSelector" style="font-size: 14px;">Choose a Model:</label>
            <select id="modelSelector">
                <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
                <option value="gpt-3.5-turbo-16k">GPT-3.5 Turbo 16K</option>
                <option value="gpt-4" selected>GPT-4</option>
                <option value="gpt-4-32k">GPT-4 32K</option>
                <option value="gpt-4-1106-preview">GPT-4 1106 Preview</option>
            </select>
        </div>
        <div class="input-group">
            <textarea id="message" class="input-textarea" placeholder="Type your message here"></textarea>
            <button class="action-button" onclick="sendMessage()">Send Message</button>
            <div id="loading" style="display: none;">
                <div class="spinner"></div>
            </div>
        </div>

        <div class="container">
            <h2 id="vaultHeadline">Items</h2>
            <table id="itemsTable">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Created</th>
                        <th>Data</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <!-- Items will be added here dynamically -->
                </tbody>
            </table>
            <div id="pagination">
                <input type="number" id="pageInput" min="1" placeholder="Page No" style="width: 60px;">
                <button onclick="goToPage()">Go</button>
                <span id="pageInfo"></span>
            </div>
        </div>
    
        <script>
            let vectorVault;

            window.onload = function() {
                // Retrieve and populate fields from local storage when the page loads
                retrieveFromLocalStorage();
                toggleInputFields();
            }
            async function connectToVault() {
                const user = document.getElementById('user').value;
                const vault = document.getElementById('vault').value;
                const api = document.getElementById('api').value;
                const openai_key = document.getElementById('openai_key').value;
                // Save the entered values to local storage
                saveToLocalStorage();

                try {
                    // Clear the data table 
                    document.getElementById('tableBody').innerHTML = '';
                    // Display loading spinner
                    const loadingElement = document.getElementById('loading');
                    loadingElement.style.display = 'block';

                    vectorVault = new VectorVaultAPI(user, vault, api, openai_key);
                    console.log("Connected to VectorVault");
                    alert("Connection successful!");
                    // Now that we're connected, fetch the total items and display them
                    fetchTotalItems().then(() => {
                        fetchAndDisplayItems();
                    });
                    updateHeadline(vault); 

                    try { // Fetch personality message if it exists
                        const personalityMessage = await vectorVault.fetchPersonalityMessage();
                        document.getElementById('personalityMessage').value = personalityMessage; 
                        loadingElement.style.display = 'none';
                    } catch (fetchError) {
                        loadingElement.style.display = 'none';
                        console.error("Error fetching personality message:", fetchError);
                        // Handle the error - maybe set the textarea to empty or display a default message
                        document.getElementById('personalityMessage').value = 'Say everything like Snoop Dogg'; // Set to standard string if fetching fails
                    }

                } catch (error) {
                    console.error("Connection failed:", error);
                    alert("Connection failed!");
                }
            }

            async function sendMessage() {
                const message = document.getElementById('message').value;
                const loadingElement = document.getElementById('loading');
                const selectedModel = document.getElementById('modelSelector').value; // Retrieve selected model

                if (!message) {
                    alert("Please enter a message.");
                    return;
                }
                // Show the loading indicator
                loadingElement.style.display = 'block';

                // Retrieve the conversation history from the DOM
                const history = Array.from(document.getElementById('responseContainer').children)
                                    .map(p => p.textContent.replace(/^You: /, 'User: '))
                                    .join('\n');
                try {
                    // Get the chat response with the history included
                    const response =  await vectorVault.getChat({ 
                                                            text: message, 
                                                            get_context: true, 
                                                            history: history, 
                                                            model: selectedModel // Use the selected model 
                                                        });
                    displayUserMessage(message);
                    displayResponse(response);
                    document.getElementById('message').value = ''; 
                } catch (error) {
                    console.error("Error:", error);
                } finally {
                    // Hide the loading indicator
                    loadingElement.style.display = 'none';
                }
            }
    
            function updateHeadline(vaultName) {
                const headline = document.getElementById('vaultHeadline');
                headline.textContent = vaultName + " Items"; // Change the text content of the h2 element
            }

            function displayUserMessage(message) {
                const responseContainer = document.getElementById('responseContainer');
                const userMessage = document.createElement('p');
                userMessage.textContent = "You: " + message;
                responseContainer.appendChild(userMessage);
            }
    
            function displayResponse(response) {
                const responseContainer = document.getElementById('responseContainer');
                const newResponse = document.createElement('p');
                newResponse.textContent = "Agent: " + response;
                responseContainer.appendChild(newResponse);
            }
    
            async function saveDataToVault() {
                const loadingElement = document.getElementById('loading');
                loadingElement.style.display = 'block';
                const data = document.getElementById('data').value;
                if (!data) {
                    alert("Please enter data to save.");
                    return;
                }
    
                try {
                    const saveResponse = await vectorVault.addCloud({ text: data });
                    console.log("Data saved to vault:", saveResponse);
                    loadingElement.style.display = 'none';
                    alert("Data saved successfully!");
                    document.getElementById('data').value = ''; // Clearing the data field
                    // Now that we saved, fetch the new items and display them
                    fetchTotalItems().then(() => {
                        fetchAndDisplayItems();
                    });
                } catch (error) {
                    loadingElement.style.display = 'none';
                    console.error("Error saving data:", error);
                    alert("Error saving data.");
                }
            }

            async function addSiteToVault() {
                const loadingElement = document.getElementById('loading');
                loadingElement.style.display = 'block';
                const site = document.getElementById('site').value;
                console.log('site:', site)
                if (!site) {
                    alert("Please enter site to save.");
                    return;
                }
    
                try {
                    const saveResponse = await vectorVault.addSite({ site: site });
                    console.log("Site data saved to vault:", saveResponse);
                    loadingElement.style.display = 'none';
                    alert("Site data saved successfully!");
                    document.getElementById('site').value = ''; // Clearing the data field
                    // Now that we saved, fetch the new items and display them
                    fetchTotalItems().then(() => {
                        fetchAndDisplayItems();
                    });
                } catch (error) {
                    loadingElement.style.display = 'none';
                    console.error("Error saving site:", error);
                    alert("Error saving site.");
                }
            }

            let currentPage = 1;
            const itemsPerPage = 10;
            let totalItems = 0;

            async function fetchTotalItems() {
                try {
                    const loadingElement = document.getElementById('loading');
                    loadingElement.style.display = 'block';
                    const total = await vectorVault.getTotalItems();
                    totalItems = total;
                    updatePageInfo();
                    loadingElement.style.display = 'none';
                } catch (error) {
                    loadingElement.style.display = 'none';
                    console.error("Error fetching total items:", error);
                }
            }

            function updatePageInfo() {
                const totalPages = Math.ceil(totalItems / itemsPerPage);
                document.getElementById('pageInfo').textContent = `Page ${currentPage} of ${totalPages} (${totalItems} items)`;
            }

            async function fetchAndDisplayItems() {
                try {
                    const loadingElement = document.getElementById('loading');
                    loadingElement.style.display = 'block';

                    // Check if the total number of items is 0. If so, exit early.
                    if (totalItems === 0) {
                                document.getElementById('tableBody').innerHTML = '<tr><td colspan="5">No items available.</td></tr>';
                                document.getElementById('pageInfo').textContent = 'No items available';
                                loadingElement.style.display = 'none';
                                return; // Exit the function early
                            }
                    
                    // Adjust for zero-based indexing by subtracting 1
                    const startId = (currentPage - 1) * itemsPerPage;

                    // Determine the number of items to display on the current page
                    let numberOfItemsToDisplay;
                    if (currentPage * itemsPerPage > totalItems) {
                        // If on the last page, calculate the remaining items
                        numberOfItemsToDisplay = totalItems % itemsPerPage;
                    } else {
                        // Otherwise, display the full set of items per page
                        numberOfItemsToDisplay = itemsPerPage;
                    }

                    // If the number of items to display is zero and we're not on the first page, 
                    // it means there are no items to display on the last page, so set the number to itemsPerPage
                    if (numberOfItemsToDisplay === 0 && currentPage > 1) {
                        numberOfItemsToDisplay = itemsPerPage;
                    }

                    // Generate the item IDs based on the current page and number of items to display
                    const itemIds = Array.from({ length: numberOfItemsToDisplay }, (_, i) => startId + i);
                    console.log(itemIds)

                    // Fetch the items based on the calculated item IDs
                    const items = await vectorVault.getItems(itemIds);
                    document.getElementById('tableBody').innerHTML = '';

                    // Populate the table with the fetched items
                    items.forEach(item => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${item.metadata.item_id}</td>
                            <td>${item.metadata.name}</td>
                            <td>${formatTimestamp(item.metadata.created)}</td>
                            <td>${item.data}</td>
                            <td><button onclick="deleteItem(${item.metadata.item_id})">üóëÔ∏è</button></td>
                        `;
                        document.getElementById('tableBody').appendChild(row);
                    });
                    // Hide the loading indicator
                    loadingElement.style.display = 'none';
                } catch (error) {
                    console.error("Error fetching items:", error);
                } 
            }

            function sleep(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
            async function savePersonalityMessageToVault() {
                const personalityMessage = document.getElementById('personalityMessage').value;
                if (!personalityMessage) {
                    alert("Please enter a personality message.");
                    return;
                }
                
                try {
                    await vectorVault.savePersonalityMessage(personalityMessage);
                    console.log("Personality message saved:", personalityMessage);
                    alert("Personality message saved successfully!");
                } catch (error) {
                    console.error("Error saving personality message:", error);
                    alert("Error saving personality message.");
                }
            }

            async function deleteItem(itemId) {
                const loadingElement = document.getElementById('loading');
                loadingElement.style.display = 'block';
                // Implement item deletion logic here
                vectorVault.deleteItems([itemId]);
                await sleep(15000);
                // Refresh the items list after deletion
                loadingElement.style.display = 'none';
                fetchTotalItems().then(() => {
                        fetchAndDisplayItems();
                });
            }
            
            function formatTimestamp(timestamp) {
                if (!timestamp) return '';

                const date = new Date(timestamp);
                const options = { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' };
                return date.toLocaleString('en-US', options);
            }
            
            function clearChat() {
                const responseContainer = document.getElementById('responseContainer');
                responseContainer.innerHTML = ''; // This will remove all child elements in the responseContainer
            }
            
            function toggleInputFields() {
                var selector = document.getElementById('addToVaultSelector');
                var value = selector.value;

                document.getElementById('urlInput').style.display = (value === 'url') ? 'flex' : 'none';
                document.getElementById('textInput').style.display = (value === 'text') ? 'flex' : 'none';
            }

            function changePage(delta) {
                const totalPages = Math.ceil(totalItems / itemsPerPage);
                currentPage = Math.max(1, Math.min(currentPage + delta, totalPages));
                fetchAndDisplayItems();
                updatePageInfo();
            }

            function goToPage() {
                const pageInput = document.getElementById('pageInput');
                const page = parseInt(pageInput.value, 10);

                if (!Number.isNaN(page)) {
                    const totalPages = Math.ceil(totalItems / itemsPerPage);
                    if (page >= 1 && page <= totalPages) {
                        currentPage = page;
                        fetchAndDisplayItems(); // This function must be defined and working correctly
                        updatePageInfo();      // This function updates the displayed page info
                    } else {
                        alert('Invalid page number. Total pages: ' + totalPages);
                    }
                } else {
                    alert('Please enter a valid page number.');
                }

                pageInput.value = ''; // Clear the page input field
            }
            
            function saveToLocalStorage() {
                // save login to localstorage in the browser - easier for development
                const user = document.getElementById('user').value;
                const vault = document.getElementById('vault').value;
                const api = document.getElementById('api').value;
                const openai_key = document.getElementById('openai_key').value;

                localStorage.setItem('user', user);
                localStorage.setItem('vault', vault);
                localStorage.setItem('api', api);
                localStorage.setItem('openai_key', openai_key);
            }

            function retrieveFromLocalStorage() {
                const user = localStorage.getItem('user');
                const vault = localStorage.getItem('vault');
                const api = localStorage.getItem('api');
                const openai_key = localStorage.getItem('openai_key');

                if (user) document.getElementById('user').value = user;
                if (vault) document.getElementById('vault').value = vault;
                if (api) document.getElementById('api').value = api;
                if (openai_key) document.getElementById('openai_key').value = openai_key;
            }


        // Intitialize Vector Vault API - DO NOT EDIT 
        // This class connects to the Vector Vault Cloud API and is a copy of the official Vector Vault npm package
        class VectorVaultAPI {
            constructor(user, vault, apiKey, openAIKey) {
                this.user = user;
                this.vault = vault;
                this.apiKey = apiKey;
                this.openAIKey = openAIKey;
            }

            getChat(params) {
                const url = "https://api.vectorvault.io/get_chat";
                
                const data = {
                    user: this.user, 
                    vault: this.vault,
                    api_key: this.apiKey,
                    openai_key: this.openAIKey,
                    text: '',
                    history: null,
                    summary: false,
                    get_context: false,
                    n_context: 4,
                    return_context: false,
                    smart_history_search: false,
                    model: "gpt-3.5-turbo",
                    include_context_meta: false,
                    custom_prompt: false,
                    temperature: 0,
                    timeout: 45,
                    ...params
                };

                // Send the POST request
                return fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                })
                .then(response => response.json());
            }

            async getChatStream(params, callback) {

                const url = "https://api.vectorvault.io/stream";

                const data = {
                    user: this.user,
                    vault: this.vault,
                    api_key: this.apiKey,
                    openai_key: this.openAIKey,
                    text: '',
                    history: null,
                    summary: false,
                    get_context: false,
                    n_context: 4,
                    return_context: false,
                    smart_history_search: false,
                    model: "gpt-3.5-turbo",
                    include_context_meta: false,
                    metatag: [],
                    metatag_prefixes: [],
                    metatag_suffixes: [],
                    custom_prompt: false,
                    temperature: 0,
                    timeout: 45,
                    ...params
                };

                const response = await fetch(url, {
                method: 'POST',
                headers: {
                'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
                });

                const reader = response.body.getReader();

                while (true) {
                const { done, value } = await reader.read();
                if (done) break;

                const textChunk = new TextDecoder().decode(value, { stream: true });
                const lines = textChunk.split('\n');
                for (let line of lines) {
                    if (line.startsWith('data:')) {
                        const json_data = JSON.parse(line.substring('data: '.length));
                        const word = json_data['data'] 
                        if (word != '!END') {
                            callback(word); // Call the callback function with the data
                            }
                        }
                    }
                }
            }

            getItems(itemIds) {
                // itemIds must be a list of integers
                const url = "https://api.vectorvault.io/get_items";

                const data = {
                    user: this.user,
                    api_key: this.apiKey,
                    vault: this.vault,
                    item_ids: itemIds
                };

                // Send the POST request
                return fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                })
                .then(response => {
                    if (response.ok) {
                        return response.json();
                    } else {
                        return response.json().then(json => {
                            throw new Error("Failed: " + JSON.stringify(json));
                        });
                    }
                });
            }

            editItem(itemId, newText) {
                const url = "https://api.vectorvault.io/edit_item";

                const data = {
                    user: this.user,
                    vault: this.vault,
                    api_key: this.apiKey,
                    openai_key: this.openAIKey,
                    item_id: itemId,
                    text: newText
                };

                // Send the POST request
                return fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                })
                .then(response => response.json());
            }

            getTotalItems() {
                const url = "https://api.vectorvault.io/get_total_items";

                const data = {
                    user: this.user,
                    api_key: this.apiKey,
                    vault: this.vault
                };

                // Send the POST request
                return fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                })
                .then(response => {
                    if (response.ok) {
                        return response.json();
                    } else {
                        return response.json().then(json => {
                            throw new Error("Failed: " + JSON.stringify(json));
                        });
                    }
                });
            }

            deleteItems(itemId) {
                const url = "https://api.vectorvault.io/delete_items";

                const data = {
                    user: this.user,
                    vault: this.vault,
                    api_key: this.apiKey,
                    item_id: itemId
                };

                // Send the POST request
                return fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                })
                .then(response => response.json());
            }

            addCloud(params) {
                const url = "https://api.vectorvault.io/add_cloud";

                const data = {
                    user: this.user,
                    vault: this.vault,
                    api_key: this.apiKey,
                    openai_key: this.openAIKey,
                    text: '',
                    meta: null,
                    name: null,
                    split: false,
                    split_size: 1000,
                    gen_sum: false,
                    ...params
                };

                // Send the POST request
                return fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                })
                .then(response => response.json());
            }

            addSite(params) {
                const url = "https://api.vectorvault.io/add_site";

                const data = {
                    user: this.user,
                    vault: this.vault,
                    api_key: this.apiKey,
                    openai_key: this.openAIKey,
                    site: '',
                    ...params
                };

                // Send the POST request
                return fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                })
                .then(response => response.json());
            }

            getVaults() {
                const url = "https://api.vectorvault.io/get_vaults";

                const data = {
                    user: this.user,
                    vault: this.vault,
                    api_key: this.apiKey
                };

                // Send the POST request
                return fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                })
                .then(response => response.json());
            }
            
            getDistance(id1, id2) {
                const url = "https://api.vectorvault.io/get_distance";

                const data = {
                    user: this.user,
                    vault: this.vault,
                    api_key: this.apiKey,
                    id1: id1,
                    id2: id2
                };

                // Send the POST request
                return fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                })
                .then(response => response.json());
            }

            getSimilar(params) {
                const url = "https://api.vectorvault.io/get_similar";

                const data = {
                    user: this.user,
                    vault: this.vault,
                    api_key: this.apiKey,
                    openai_key: this.openAIKey,
                    text: '',
                    num_items: 4,
                    include_distances: false,
                    ...params 
                };

                // Send the POST request
                return fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                })
                .then(response => response.json());
            }

            savePersonalityMessage(personalityMessage) {
                const url = "https://api.vectorvault.io/save_personality_message";

                const data = {
                    user: this.user,
                    vault: this.vault,
                    api_key: this.apiKey,
                    personality_message: personalityMessage
                };

                // Send the POST request
                return fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                })
                .then(response => response.json());
            }

            saveCustomPrompt(customPrompt) {
                const url = "https://api.vectorvault.io/save_custom_prompt";

                const data = {
                    user: this.user,
                    vault: this.vault,
                    api_key: this.apiKey,
                    prompt: customPrompt
                };

                // Send the POST request
                return fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                })
                .then(response => response.json());
            }

            fetchPersonalityMessage() {
                const url = "https://api.vectorvault.io/fetch_personality_message";

                const data = {
                    user: this.user,
                    vault: this.vault,
                    api_key: this.apiKey,
                };

                // Send the POST request
                return fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                })
                .then(response => response.json());
            }

            fetchCustomPrompt() {
                const url = "https://api.vectorvault.io/fetch_custom_prompt";

                const data = {
                    user: this.user,
                    vault: this.vault,
                    api_key: this.apiKey,
                };

                // Send the POST request
                return fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                })
                .then(response => response.json());
            }
        }

        function handleStreamedData(data) {
            // Here you can process the data, update UI, store in a database, etc.
            console.log(data);
        }
        </script>
</body>
</html>